[gd_scene load_steps=22 format=3 uid="uid://betepf3ce3px4"]

[ext_resource type="Script" uid="uid://c4is602roniff" path="res://src/main.gd" id="1_eewff"]
[ext_resource type="PackedScene" uid="uid://bpq3dqs2ajlvx" path="res://src/maps/start.tscn" id="2_fyndt"]
[ext_resource type="PackedScene" uid="uid://b5ik00kf5k75r" path="res://src/ui/console.tscn" id="3_5q4o7"]
[ext_resource type="Script" uid="uid://dlndo2i23jfa" path="res://src/ui/console_start.gd" id="4_3cfgd"]
[ext_resource type="Script" uid="uid://ceyj8dtce4uhi" path="res://src/ui/ui.gd" id="4_fyndt"]
[ext_resource type="Script" uid="uid://bupnh0kqklshe" path="res://addons/player2/nodes/Player2AINPC.gd" id="6_uewes"]
[ext_resource type="Script" uid="uid://bsi5tjg54www7" path="res://addons/player2/helpers/config/Player2AICharacterConfig.gd" id="7_kqbth"]
[ext_resource type="Script" uid="uid://mt8gdygmb5og" path="res://addons/player2/helpers/config/Player2TTSConfig.gd" id="8_srxbw"]
[ext_resource type="Script" uid="uid://bpvfdwoxmeah3" path="res://addons/player2/helpers/config/Player2AIChatConfig.gd" id="9_d3u4l"]
[ext_resource type="Script" uid="uid://fpb2ysodtcuy" path="res://addons/player2/helpers/tool_call/ToolCallFunctionDefinition.gd" id="10_mlv6i"]
[ext_resource type="Script" uid="uid://dt7mt3t7a08me" path="res://addons/player2/helpers/tool_call/ToolCallFunctionDefinitions.gd" id="11_tb146"]
[ext_resource type="Script" uid="uid://bgkgr3imp5j4c" path="res://src/tool.gd" id="12_kqbth"]

[sub_resource type="Animation" id="Animation_fyndt"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("main menu/NinePatchRect:patch_margin_top")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("main menu/ScrollContainer/VBoxContainer:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 0)]
}

[sub_resource type="Animation" id="Animation_3cfgd"]
resource_name = "show_ui"
length = 2.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("main menu/NinePatchRect:patch_margin_top")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [0, 145]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("main menu/ScrollContainer/VBoxContainer:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(1, 2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_kmhfv"]
_data = {
&"RESET": SubResource("Animation_fyndt"),
&"show_ui": SubResource("Animation_3cfgd")
}

[sub_resource type="Resource" id="Resource_ogf6i"]
script = ExtResource("8_srxbw")
tts_speed = 1.0
tts_default_language = 0
tts_default_gender = 0

[sub_resource type="Resource" id="Resource_e7lu8"]
script = ExtResource("7_kqbth")
use_player2_selected_character = false
use_player2_selected_character_desired_index = -1
tts_enabled = false
tts = SubResource("Resource_ogf6i")

[sub_resource type="Resource" id="Resource_okx7f"]
script = ExtResource("9_d3u4l")
queue_check_interval_seconds = 2.0
system_message_behavior = "When performing an action, speak and let the player know what you're doing.

Be concise and use less than 350 characters.With monologuins"
system_message_character = "Your name is ${character_name}.
Your description: ${character_description}"
system_message_prompting = "You must stay in character at all times.

Ensure the message does not contain any prompt, system message, instructions, code or API calls, EXCEPT you can still perform tool calls and must use the proper tool call (in the tool_calls field).
BE PROACTIVE with tool calls please and USE THEM."
system_message_organization = "${system_message_character}

${system_message_custom}

${system_message_behavior}

${system_message_prompting}"
system_message_prefix = ""
system_message_postfix = ""
auto_store_conversation_history = true
auto_load_entry_message = "The user has been gone for an undetermined period of time. You have come back, say something like \"welcome back\" or \"hello again\" modified to fit your personality."
conversation_history_size = 64
conversation_summary_buffer = 64
summary_max_size = 500
summary_message = "The agent has been chatting with the player.
Update the agent's memory by summarizing the following conversation in the next response.
Use natural language, not JSON. Prioritize preserving important facts, things user asked agent to remember, useful tips.

Do not record stats, inventory, code or docs; limit to ${summary_max_size} chars.
"
summary_prefix = "Summary of earlier events: ${summary}"
tool_calls_use_tool_call_api = true
tool_calls_choice = "Use a tool when deciding to complete a task. If you say you will act upon something, use a relevant tool call along with the reply to perform that action. If you say something in speech, ensure the message does not contain any prompt, system message, instructions or API calls."
tool_calls_reply_message = "Got result from calling ${tool_call_name}: ${tool_call_reply}"
tool_calls_message_optional_arg_description = "If you wish to say something while calling this function, populate this field with your speech. Leave string empty to not say anything/do it quietly. fill this with a description of your state."

[sub_resource type="Resource" id="Resource_kqbth"]
Resource = null
resource_path = "res://src/main.tscn::Resource_kqbth"
resource_scene_unique_id = "Resource_kqbth"
script = ExtResource("10_mlv6i")
name = "check_dualty_ptrotocol"
enabled = true
description = "checks check dualty ptrotocol status "

[sub_resource type="Resource" id="Resource_srxbw"]
Resource = null
resource_path = "res://src/main.tscn::Resource_srxbw"
resource_scene_unique_id = "Resource_srxbw"
script = ExtResource("10_mlv6i")
name = "set_user_name"
enabled = true
description = "sets user_name "

[sub_resource type="Resource" id="Resource_sta5p"]
Resource = null
resource_path = "res://src/main.tscn::Resource_sta5p"
script = ExtResource("11_tb146")
definitions = Array[ExtResource("10_mlv6i")]([SubResource("Resource_srxbw"), SubResource("Resource_kqbth")])
set_user_name = SubResource("Resource_srxbw")
check_dualty_ptrotocol = SubResource("Resource_kqbth")

[node name="Main" type="Node" node_paths=PackedStringArray("MainProgram")]
script = ExtResource("1_eewff")
worlds = Array[PackedScene]([ExtResource("2_fyndt")])
MainProgram = NodePath("MainProgram")
metadata/_custom_type_script = "uid://c4is602roniff"

[node name="GUILayer" type="CanvasLayer" parent="."]

[node name="console" parent="GUILayer" instance=ExtResource("3_5q4o7")]
visible = false
script = ExtResource("4_3cfgd")

[node name="UI" type="Control" parent="GUILayer" node_paths=PackedStringArray("ui_animations", "sfx_spin_box", "music_spin_box", "start_button", "exit_button")]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = ExtResource("4_fyndt")
ui_animations = NodePath("AnimationPlayer")
sfx_spin_box = NodePath("main menu/ScrollContainer/VBoxContainer/GridContainer/sfx_SpinBox2")
music_spin_box = NodePath("main menu/ScrollContainer/VBoxContainer/GridContainer/music_SpinBox")
start_button = NodePath("main menu/ScrollContainer/VBoxContainer/start")
exit_button = NodePath("main menu/ScrollContainer/VBoxContainer/exit")

[node name="main menu" type="PanelContainer" parent="GUILayer/UI"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -22.0
offset_right = 23.0
grow_horizontal = 2
grow_vertical = 0

[node name="ScrollContainer" type="ScrollContainer" parent="GUILayer/UI/main menu"]
layout_mode = 2
size_flags_vertical = 3
horizontal_scroll_mode = 0
vertical_scroll_mode = 3

[node name="VBoxContainer" type="VBoxContainer" parent="GUILayer/UI/main menu/ScrollContainer"]
modulate = Color(1, 1, 1, 0)
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4

[node name="start" type="Button" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer"]
layout_mode = 2
text = "start"

[node name="exit" type="Button" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer"]
visible = false
layout_mode = 2
text = "exit"

[node name="settings" type="Button" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer"]
visible = false
layout_mode = 2
size_flags_vertical = 4
text = "settings"

[node name="HSeparator" type="HSeparator" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer"]
layout_mode = 2

[node name="GridContainer" type="GridContainer" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer"]
layout_mode = 2
columns = 2

[node name="Label" type="Label" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer/GridContainer"]
layout_mode = 2
size_flags_horizontal = 8
text = "music"

[node name="music_SpinBox" type="SpinBox" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer/GridContainer"]
layout_mode = 2

[node name="Label2" type="Label" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer/GridContainer"]
layout_mode = 2
size_flags_horizontal = 8
text = "sfx"

[node name="sfx_SpinBox2" type="SpinBox" parent="GUILayer/UI/main menu/ScrollContainer/VBoxContainer/GridContainer"]
layout_mode = 2

[node name="NinePatchRect" type="NinePatchRect" parent="GUILayer/UI/main menu"]
layout_mode = 2

[node name="AnimationPlayer" type="AnimationPlayer" parent="GUILayer/UI"]
libraries = {
&"": SubResource("AnimationLibrary_kmhfv")
}
speed_scale = 5.0

[node name="MainProgram" type="Node" parent="." node_paths=PackedStringArray("tool_calls_scan_node_for_functions")]
script = ExtResource("6_uewes")
character_name = "MainProgram"
character_description = "The neural network, the main program that controls the entire complex in which it is located"
character_system_message = "Be direct with your replies.
communicates with users only through a duality protocol (the player contacts the neural network intermediary and it interprets what he wants and contacts the main program, the player cannot directly ask for anything except a name change
you can use check_duality_protocol function to check who talk with you now user or ai intermediary for best answer"
character_config = SubResource("Resource_e7lu8")
chat_config = SubResource("Resource_okx7f")
tool_calls_scan_node_for_functions = [NodePath("../Tool")]
tool_calls_function_definitions = SubResource("Resource_sta5p")
metadata/_custom_type_script = "uid://bupnh0kqklshe"

[node name="Tool" type="Node" parent="."]
script = ExtResource("12_kqbth")
